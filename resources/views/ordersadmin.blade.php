@extends('layouts.app')
@section('title','Orders')

@section('content')
<div class="col-md-12">
	<div class="panel panel-primary" style="overflow-x: scroll;">
		<div class="panel-heading text-center">
			<b style="color:white;font-size:1.4em">Orders</b>
			<a class="pull-right btn btn-sm btn-danger" href="{{URL::to('/')}}/home" id="btn1" style="color:white;"><b>Back</b></a>
		</div>
		<div class="panel-body">
			<table class="table table-responsive table-striped">
				<thead>
				    <th>Project ID</th>
				    <th>Generated By</th>
				    <th>Designation</th>
					<th>Main Category</th>
					<th>Sub Category</th>
					<th>Quantity</th>
					<th>Status</th>
					<th>Requirement Date</th>
					<!--<th>Payment Status</th>-->
					<th>Dispatch Status</th>
					<th>Delivery Status</th>
					<th>Print Invoice</th>
				</thead>
				<tbody>
					@foreach($view as $rec)
					<tr id="row-{{$rec->id}}">
						<td><a href="{{URL::to('/')}}/showProjectDetails?id={{$rec->project_id}}">{{$rec -> project_id}}</a></td>
						<td>{{$rec -> name }}</td>
						@if($rec -> group_id == '6')
						    <td>Listing Engineer</td>
						@elseif($rec -> group_id == '7')
						    <td>Sales Engineer</td>
						@else
						    <td>{{$rec -> group_id}}</td>
						@endif
						<td>{{$rec -> main_category}}</td>
						<td>{{$rec -> sub_category}}</td>
						<td>{{$rec->quantity}} {{$rec->measurement_unit}}</td>
						<td>{{$rec->status}}</td>
						<td>{{$rec -> requirement_date}}</td>
                        <!--<td id="paymenttd-{{$rec->id}}">-->
                        <!--    <select id="selectPayment-{{$rec->id}}" class="form-control" name="selectPayment-{{$rec->id}}" onchange="pay('{{$rec->id}}')">-->
                        <!--        <option value="" disabled selected>-- SELECT --</option>-->
                        <!--        <option value="Payment Received" {{$rec->payment_status == 'Payment Received'?'selected':''}}>Payment Received</option>-->
                        <!--        <option value="Payment Pending" {{$rec->payment_status == 'Payment Pending'?'selected':''}}>Payment Pending</option>-->
                        <!--    </select>-->
                        <!--</td>-->
                        <td>
                            <!--<select id="selectdispatch-{{$rec->id}}" class="form-control" name="selectdispatch-{{$rec->id}}" onchange="updateDispatch('{{$rec->id}}')">-->
                            <!--    <option value="" disabled selected>-- SELECT --</option>-->
                            <!--    <option value="Yes" {{$rec-> dispatch_status == 'Yes'?'selected':''}}>Yes</option>-->
                            <!--    <option value="No" {{$rec-> dispatch_status == 'No'?'selected':''}}>No</option>-->
                            <!--</select>-->
                            @if($rec->dispatch_status)
                            {{$rec->dispatch_status}}
                            @elseif(!$rec->dispatch_status)
                            Not Yet Dispatched
                            @endif
                        </td>
						<td>
						    @if($rec -> delivery_status)
						    {{$rec -> delivery_status}}
						    @else
						    Not Delivered
						    @endif
						</td>
						@if($rec->status === 'Order Confirmed' && $rec->delivery_status === 'Delivered')    
						<td>
						    <!--<a href="{{URL::to('/')}}/{{$rec->project_id}}/printLPO" target="_blank" class="btn btn-sm btn-primary" >Print Invoice</a>-->
					        Invoice Generated
					    </td>
					    @else
					    <td>Invoice Not Generated</td>
					    @endif
					</tr>
					@endforeach
				</tbody>	
			</table>
			<br>
			<center>{{$view->links()}}</center>	
		</div>
	</div>
</div>
<script type="text/javascript">
	
	function pay(arg)
	{
		var e = document.getElementById("selectPayment-"+arg);
		var strUser = e.options[e.selectedIndex].value;
		var ans = confirm('Are You Sure ? Note: Changes Made Once CANNOT Be Undone');
		if(ans){
			$.ajax({
				type: 'GET',
				url: "{{URL::to('/')}}/updateampay",
				data: {payment: strUser, id: arg},
				async: false,
				success: function(response){
					console.log(response);
				}
			});
		}
		return false;
	}

	function updateDispatch(arg)
	{
		var e = document.getElementById("selectdispatch-"+arg);
		var strUser = e.options[e.selectedIndex].value;
		var ans = confirm('Are You Sure ? Note: Changes Made Once CANNOT Be Undone');
		if(ans){
    		$.ajax({
    			type: 'GET',
    			url: "{{URL::to('/')}}/updateamdispatch",
    			data: {dispatch: strUser, id: arg},
    			async: false,
    			success: function(response){
    				console.log(response);	
    			}
    		});
		}
		return false;	
	}
	
	function confirmOrder(arg)
	{
	    var ans = confirm('Are You Sure To Confirm This Order ?');
	    if(ans)
	    {
    	    $.ajax({
    	       type:'GET',
    	       url: "{{URL::to('/')}}/confirmOrder",
    	       data: {id : arg},
    	       async: false,
    	       success: function(response)
    	       {
    	           console.log(response);
    	           location.reload(true);
    	       }
    	    });
	    }    
	}
	
	function cancelOrder(arg)
	{
	    var ans = confirm('Are You Sure To Cancel This Order ?');
	    if(ans)
	    {
    	    $.ajax({
    	       type:'GET',
    	       url: "{{URL::to('/')}}/cancelOrder",
    	       data: {id : arg},
    	       async: false,
    	       success: function(response)
    	       {
    	           console.log(response);
    	           location.reload(true);
    	       }
    	    });
	    }
	 }

</script>
@endsection